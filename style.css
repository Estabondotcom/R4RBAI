:root{
  --bg:#0e0d0b;--ink:#1b1a18;--paper:#f6f1e7;--paper-edge:#e1d7c6;--accent:#8b6b45;
  --text:#13120f;--muted:#6b665c;--ui:#d3c7b2;--ink-weak:#3e3a33;--brand:#7c5b2e;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;}
.app{display:flex;flex-direction:column;height:100vh;max-width:1100px;margin:0 auto;gap:8px;padding:8px}

/* --- Book (top) --- */
.top{
  position:relative;flex:2;overflow:auto;border-radius:14px;padding:18px 16px 28px;
  background:
    radial-gradient(140% 100% at 0% 0%, rgba(0,0,0,.07), transparent 60%),
    radial-gradient(140% 100% at 100% 100%, rgba(0,0,0,.08), transparent 60%),
    linear-gradient(180deg, var(--paper) 0%, #fff 3%, var(--paper) 10%, var(--paper) 100%);
  box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px var(--paper-edge);
}
.book-header{position:sticky;top:-1px;background:linear-gradient(180deg, rgba(246,241,231,.98), rgba(246,241,231,.92));padding:4px 6px 8px;border-bottom:1px solid var(--paper-edge);z-index:1}
.chapter{font-variant: small-caps;letter-spacing:.06em;color:var(--ink-weak);font-size:.82rem}
.book{white-space:pre-wrap;line-height:1.5;color:var(--text);font-size:1.02rem}
.book p{margin:0 0 .8em 0}
.book .fade-in{animation:fade .4s ease}
@keyframes fade{from{opacity:0;transform:translateY(2px)}to{opacity:1;transform:translateY(0)}
}
/* --- Bottom (chat) --- */
.bottom{flex:1;display:flex;flex-direction:column;gap:6px}
.dock{
  display:flex;gap:8px;background:#151410;border:1px solid #2b2923;border-radius:12px;padding:8px;align-items:flex-end;
}
.messages{flex:1;min-height:64px;max-height:40vh;overflow:auto;padding:8px;border-radius:8px;background:#100f0c}
.msg{color:#e9e5db;font-size:.95rem;margin:0 0 .5em}
.msg .tag{color:#b7b1a5;font-size:.8rem;margin-right:.5ch}
.inputRow{display:flex;gap:8px;width:100%}
textarea{
  flex:1;resize:none;min-height:44px;max-height:120px;padding:10px;border-radius:10px;border:1px solid #2c2a25;background:#0f0e0b;color:#efeae0;
}
button{
  border:1px solid #3b3428;background:linear-gradient(#2b261f,#201c16);color:#f0e7d8;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer;
}
button:active{transform:translateY(1px)}
.row{display:flex;gap:8px;align-items:center;justify-content:space-between}
.muted{color:#a59e91;font-size:.85rem}
.tiny{font-size:.78rem;color:#9a917f}
.chip{padding:.25rem .5rem;border:1px solid #3b3428;border-radius:999px;background:#14120e;color:#d9d2c5;font-size:.78rem}
.scrolllock{cursor:pointer}

/* --- Right tray --- */
.tray-toggle{
  position:fixed;right:10px;top:10px;z-index:5;border-radius:999px;padding:8px 10px
}
.tray{
  position:fixed;right:10px;top:56px;bottom:10px;width:min(92vw,320px);
  background:#14120e;border:1px solid #2b2923;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.45);
  display:none;flex-direction:column;overflow:hidden;z-index:5;
}
.tray.open{display:flex}
.tabs{display:flex}
.tabs button{flex:1;border-radius:0;border:none;border-bottom:1px solid #2b2923;padding:10px}
.tabs button.active{background:#1b1813}
.panel{flex:1;overflow:auto;padding:10px}
.skill{display:flex;align-items:center;gap:6px;justify-content:space-between;border-bottom:1px dashed #2a2721;padding:6px 0}
.skill .name{color:#eadfcb}
.pill{font-size:.78rem;border:1px solid #3b3428;border-radius:999px;padding:.1rem .5rem;color:#cdbfa6}
.health{display:flex;gap:6px;flex-wrap:wrap}
.portrait{width:100%;aspect-ratio:1/1;border-radius:10px;background:#0e0d0b;border:1px solid #2a2721;display:grid;place-items:center;color:#7b7263}

/* --- Mobile tweaks --- */
@media (max-width: 640px){
  .app{padding:6px}
  .top{padding:14px 12px 22px}
}
/* ===== Modal base ===== */
.modal.hidden { display: none; }
.modal { position: fixed; inset: 0; z-index: 50; }
.modal__backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.55); }

/* Dialog uses flex so header/body/footer can stick properly */
.modal__dialog {
  position: relative;
  margin: 0;               /* full-bleed on mobile */
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background: #111;
  border: none;
  border-radius: 0;
  padding: 0;
}

/* Header/Footer stick; body scrolls */
.modal__header,
.modal__footer {
  position: sticky;
  z-index: 1;
  padding: 12px 16px;
  background: #111;
}
.modal__header { top: 0; border-bottom: 1px solid #2a2a2a; }
.modal__footer { bottom: 0; border-top: 1px solid #2a2a2a; }

/* Body scrolls independently; ensure comfy padding and safe-area */
.modal__body {
  flex: 1 1 auto;
  overflow: auto;
  padding: 12px 16px calc(16px + env(safe-area-inset-bottom));
}

/* Desktop / large screens: centered dialog with rounded corners */
@media (min-width: 820px) {
  .modal__dialog {
    height: auto;
    max-height: 90vh;
    max-width: 860px;
    margin: 5vh auto;
    border: 1px solid #333;
    border-radius: 12px;
  }
  .modal__body { padding: 16px 20px; }
}

/* ===== Prevent background scroll when modal open ===== */
body.modal-open {
  overflow: hidden;
  height: 100vh;
  touch-action: none; /* avoids overscroll/“rubber band” on iOS */
}

/* ===== Form + inputs ===== */
.field { display:block; margin: 12px 0; }
.field .label { display:block; font-size:.9rem; opacity:.8; margin-bottom:6px; }

/* Stop iOS input auto-zoom by making font >= 16px */
input, textarea, select, button {
  font-size: 16px;
}

/* Portrait */
.portrait {
  width: 200px; height: 200px;
  object-fit: cover;
  border-radius: 10px;
  border: 1px solid #333;
  background: #0c0c0c;
}
@media (max-width: 420px) {
  .portrait { width: 160px; height: 160px; }
}

/* Grid helper */
.grid { display:grid; gap: 12px; }
.grid-2 { grid-template-columns: 1fr 1fr; }
@media (max-width: 760px) { .grid-2 { grid-template-columns: 1fr; } }

/* ===== Traits (bigger, thumb-friendly) ===== */
.traits { padding: 10px; border: 1px solid #2a2a2a; border-radius: 10px; background:#0c0c0c; margin: 12px 0; }
.trait  { display:flex; align-items:center; justify-content:space-between; padding: 8px 0; gap: 10px; }
.trait__name { font-weight: 600; white-space: nowrap; }

.pips { display:flex; gap:10px; flex-wrap: wrap; }
.pip {
  width: 28px; height: 28px;         /* larger tap size */
  border-radius: 50%;
  border: 1px solid #666;
  background: #141414;
  cursor: pointer;
}
.pip.active { background: #e0e0e0; }
.pip:focus-visible { outline: 2px solid #aaa; outline-offset: 2px; }

/* Make pips even bigger on small screens */
@media (max-width: 420px) {
  .pip { width: 32px; height: 32px; }
}

/* ===== Buttons ===== */
button.secondary { background: transparent; border: 1px solid #444; color: #ddd; }
.icon-btn { background:none; border:none; color:inherit; font-size:1.2rem; cursor:pointer; }

/* Sticky footer layout: buttons aligned right with safe-area padding */
.modal__footer {
  display: flex; justify-content: flex-end; gap: .5rem;
  padding-bottom: calc(12px + env(safe-area-inset-bottom));
}
